"use strict";(self.webpackChunkquanlythuchi=self.webpackChunkquanlythuchi||[]).push([[7659],{1499:(e,n,t)=>{t.d(n,{Ol:()=>i,sM:()=>c,s_:()=>s});var o=t(42104);let r=null;const s=e=>{if(r&&r.disconnect(),!e)throw console.error("\u274c Token kh\xf4ng t\u1ed3n t\u1ea1i, kh\xf4ng th\u1ec3 k\u1ebft n\u1ed1i WebSocket"),new Error("Token kh\xf4ng t\u1ed3n t\u1ea1i");const n={NODE_ENV:"production",PUBLIC_URL:"/FinanceFlow",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GEMINI_API_KEY:"AIzaSyDgxajhquGhXa49GLihn_GlNjeJn0-26lE",REACT_APP_STRIPE_PUBLISHABLE_KEY:"pk_test_51R6SFdJ0EYLbnLTiWkEe5KrRUd6XiU8w5YReJTjVjKDKYRCC6C2Wiq3uQHaZCwwuzErUfmbhJ2X4VRLm4ucj85wg00sySUeMf4"}.REACT_APP_API_URL?{NODE_ENV:"production",PUBLIC_URL:"/FinanceFlow",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GEMINI_API_KEY:"AIzaSyDgxajhquGhXa49GLihn_GlNjeJn0-26lE",REACT_APP_STRIPE_PUBLISHABLE_KEY:"pk_test_51R6SFdJ0EYLbnLTiWkEe5KrRUd6XiU8w5YReJTjVjKDKYRCC6C2Wiq3uQHaZCwwuzErUfmbhJ2X4VRLm4ucj85wg00sySUeMf4"}.REACT_APP_API_URL.replace("/api",""):"https://quanlythuchi-backend.onrender.com";return r=(0,o.io)(n,{auth:{token:"Bearer ".concat(e)},transports:["websocket"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3}),r.on("connect_error",(e=>{console.error("Socket connection error:",e.message,e.stack)})),r.on("disconnect",(()=>{console.log("\ud83d\udce1 Socket disconnected")})),console.log("\ud83d\udce1 Socket initialized with full token:","Bearer ".concat(e)),r},i=()=>r,c=()=>{r&&(r.disconnect(),r=null,console.log("\ud83d\udce1 Socket disconnected"))}},27659:(e,n,t)=>{t.r(n),t.d(n,{default:()=>S});var o=t(75678),r=t(96446),s=t(81637),i=t(85865),c=t(35721),l=t(30681),a=t(48734),d=t(67784),h=t(17392),u=t(65043),_=t(29066),g=t(1499),A=t(70579);const S=()=>{const{user:e,loading:n}=(0,_.A)(),[t,S]=(0,u.useState)([]),[p,E]=(0,u.useState)(""),[m,f]=(0,u.useState)(null),x=(0,u.useCallback)((()=>{if(!p.trim())return;const n=(0,g.Ol)();if(!n||!n.connected)return void f("Kh\xf4ng th\u1ec3 g\u1eedi tin nh\u1eafn: Ch\u01b0a k\u1ebft n\u1ed1i \u0111\u1ebfn h\u1ec7 th\u1ed1ng h\u1ed7 tr\u1ee3.");const t={_id:Date.now().toString(),sessionId:e._id,sender:"user",content:p,createdAt:new Date};n.emit("message",t),S((e=>[...e,t])),E("")}),[p,e]);return(0,u.useEffect)((()=>{if(n)return;if(!e)return void f("B\u1ea1n c\u1ea7n \u0111\u0103ng nh\u1eadp \u0111\u1ec3 chat v\u1edbi admin.");const t=localStorage.getItem("token");if(!t)return void f("Kh\xf4ng t\xecm th\u1ea5y token. Vui l\xf2ng \u0111\u0103ng nh\u1eadp l\u1ea1i.");console.log("SupportPage - User:",e);const o=(0,g.s_)(t);return o.on("connect",(()=>{console.log("\u2705 User connected to support system"),o.emit("join-support",{userId:e._id})})),o.on("message",(e=>{console.log("\ud83d\udce9 Nh\u1eadn tin nh\u1eafn t\u1eeb server:",e),S((n=>[...n,e]))})),o.on("connect_error",(e=>{console.error("\u274c Socket connection error:",e.message),f("Kh\xf4ng th\u1ec3 k\u1ebft n\u1ed1i \u0111\u1ebfn h\u1ec7 th\u1ed1ng h\u1ed7 tr\u1ee3: "+e.message)})),o.on("error",(e=>{console.error("\u274c Server error:",e),f(e)})),()=>{console.log("\u2705 \u0110\xf3ng socket t\u1eeb SupportPage"),(0,g.sM)()}}),[e,n]),n?(0,A.jsx)(r.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,A.jsx)(s.A,{})}):(0,A.jsxs)(r.A,{sx:{p:3,display:"flex",flexDirection:"column",height:"calc(100vh - 64px)"},children:[(0,A.jsx)(i.A,{variant:"h5",sx:{mb:2,fontFamily:"Poppins, sans-serif",fontWeight:"bold",color:"#1E3A8A"},children:"Chat v\u1edbi Admin"}),m&&(0,A.jsx)(i.A,{sx:{color:"error.main",mb:2,textAlign:"center"},children:m}),(0,A.jsx)(c.A,{sx:{flexGrow:1,overflowY:"auto",bgcolor:"#fafafa",borderRadius:2,p:2},children:t.map((e=>(0,A.jsx)(l.Ay,{sx:{justifyContent:"user"===e.sender?"flex-end":"flex-start",p:0},children:(0,A.jsx)(a.A,{primary:e.content,secondary:new Date(e.createdAt).toLocaleTimeString("vi-VN"),sx:{bgcolor:"user"===e.sender?"primary.light":"grey.200",color:"user"===e.sender?"white":"text.primary",p:1.5,borderRadius:2,maxWidth:"70%",fontFamily:"Poppins, sans-serif"}})},e._id)))}),(0,A.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",mt:2},children:[(0,A.jsx)(d.A,{value:p,onChange:e=>E(e.target.value),onKeyPress:e=>"Enter"===e.key&&x(),fullWidth:!0,placeholder:"Nh\u1eadp tin nh\u1eafn...",variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}}),(0,A.jsx)(h.A,{onClick:x,sx:{ml:1,color:"primary.main"},children:(0,A.jsx)(o.A,{})})]})]})}}}]);
//# sourceMappingURL=7659.654a53f6.chunk.js.map